#!/bin/bash

# ~/.function - Some sweet functions...

#######################################################
# Dynamic Servers
#######################################################

# Webserver
function server() {
    local port="${1:-8000}";
    sleep 1 && open "http://localhost:${port}/" &
    # Set the default Content-Type to `text/plain` instead of `application/octet-stream`
    # And serve everything as UTF-8 (although not technically correct, this doesnâ€™t break anything for binary files)
    python -c $'import SimpleHTTPServer;\nmap = SimpleHTTPServer.SimpleHTTPRequestHandler.extensions_map;\nmap[""] = "text/plain";\nfor key, value in map.items():\n\tmap[key] = value + ";charset=UTF-8";\nSimpleHTTPServer.test();' "$port";
}

# Simple random string - Use for Magento admin path
function random-string() {
    head /dev/urandom | tr -dc 'A-Za-z0-9' | head -c 10
}

# Add Space to dock
function dock-space() {

	defaults write com.apple.dock persistent-apps -array-add '{tile-data={}; tile-type="spacer-tile";}'
	killall Dock
}

# Remove bastard .DS_Store files recursively from the current directory
function rm-dsstore() {
	find . -name ".DS_Store" -depth -exec rm -vf {} \;
}

# List fucking .DS_Store files recursively from the current directory
function ls-dsstore() {
	find . -name ".DS_Store" -depth
}

# Display broken symlinks
function symlinks-broken() {
	find . -type l -exec test ! -e {} \; -print
}

# Remove broken symlinks
function symlinks-broken-rm() {
	find . -type l -exec test ! -e {} \; -delete
}

# Enable Xdebug extension for php-cli scripts
function xdebug-listen() {
	export XDEBUG_CONFIG="idekey=PHPSTORM"
}

# Disable Xdebug extension for php-cli scripts
function xdebug-stoplistening()
{
	unset XDEBUG_CONFIG
}

# Start docker container for DNS
# create /etc/resolver/docker with the following
#
# nameserver 127.0.0.1
# port 53535
function dns-docker() {
    docker run -d \
        --name docker_dns_dnsmasq \
        -p 53535:53/tcp \
        -p 53535:53/udp \
        --cap-add=NET_ADMIN \
        andyshinn/dnsmasq \
        --address=/docker/127.0.0.1
}

#
# Open chrome for "Person"
#
function open-chrome() {
    if [ "$#" -eq 0 ]
    then
        open -a "Google Chrome"
        return
    fi

    open -a "Google Chrome" --args --profile-directory="$1"
}
